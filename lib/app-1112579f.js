"use strict";angular.module("Giggity",["Giggity.filters","Giggity.services","Giggity.directives","Giggity.controllers","ui.bootstrap","ngSanitize","ngRoute","mgcrea.ngStrap"]).config(["$compileProvider",function(i){i.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|sms|tel|smsto):/)}]).config(["$routeProvider",function(i){i.when("/gigs/:gig_id?/:action?",{templateUrl:"partials/partial2.html",controller:"Main",reloadOnSearch:!1,resolve:{MembersData:["Members",function(i){return i.promise}],GigsData:["Gigs",function(i){return i.promise}]}}),i.otherwise({redirectTo:"/gigs"})}]).run(["$route","$rootScope","$location",function(i,n,e){var t=e.search();t.gig_id&&(e.path("/gigs/"+t.gig_id),e.search("gig_id",null));var a=e.path;e.path=function(t,l){if(l===!1)var s=i.current,o=n.$on("$locationChangeSuccess",function(){i.current=s,o()});return a.apply(e,[t])}}]),angular.module("Giggity.controllers",[]).controller("Main",["$scope","$rootScope","$window","$route","$routeParams","Requests","$location","$filter","$position","$timeout","$modal","Members","Gigs",function(i,n,e,t,a,l,s,o,r,c,g,d,p){n.app_loaded=!1,i.Members=d,i.Gigs=p,i.gig={},i.members=[],i.membersList=[],i.currentGigIndex=0,i.gig_loading=0,i.membernamefilter="",i.memberavailablefilter="",i.currentUser=localStorage.currentUser,i.location=s,i.tab={gig_details:!0},i.mobile=!1,i.mobileView="mobile-view-nav",i.showModal=!1,i.gigLimit=15,i.page=1,i.fetchAllGigs=!1,i.$on("$routeUpdate",function(){i.setView()}),i.setTab=function(n){i.tab={},i.tab[n]=!0},i.setView=function(e){e&&(a.gig_id=null,s.path("/gigs",!1));var t=a.gig_id;!i.mobile||t?(i.mobileView="mobile-view-gig",i.fetchGig(t)):(i.mobileView="mobile-view-nav",n.app_loaded=!0)},i.changeUser=function(){i.currentUser=null,i.currentUserName=null,i.user=null,localStorage.removeItem("currentUser"),$("#current_user_input").val(),i.showModal="login"},i.saveGig=function(){return i.gig.tactical=i.gig.tactical?i.gig.tactical.id:"",i.gig.musical=i.gig.musical?i.gig.musical.id:"",l.write("saveGig",i.gig,i.gig.gig_id).then(function(n){i.Gigs.gigs[n.gig_id]=n,i.Gigs.updateGigsList(),i.setGig(n)})},i.deleteGig=function(n){return i.showModal=!1,n?l.write("deleteGig",{},n).then(function(){delete i.Gigs.gigs[i.gig.gig_id],i.Gigs.updateGigsList(),i.fetchGig()}):i.fetchGig(),!1},i.changeGig=function(n,e){var t=e?"band_details":"gig_details";i.setTab(t),a.gig_id=n,s.path("/gigs/"+n,!1),i.setView()},i.setGig=function(e){i.gig=e,i.setCurrentGigIndex(),i.gig.tactical=i.gig.tactical?i.members[i.gig.tactical]:"",i.gig.musical=i.gig.musical?i.members[i.gig.musical]:"",i.membernamefilter="",i.memberavailablefilter="",i.gig_loading=0,n.app_loaded=!0},i.fetchGig=function(n){return i.gig_loading=1,n&&i.Gigs.gigs[n]||(n=i.Gigs.gigsList[0].gig_id),l.fetch("fetchGig",{gig_id:n}).then(function(n){i.setGig(n)})},i.fetchGigs=function(){return i.Gigs.fetchGigs(i.currentUser,i.fetchAllGigs)},i.newGig=function(){i.gig={title:"New Gig",availability:{}},i.setTab("band_details")},i.setCurrentGigIndex=function(){if(i.gig){var n=i.gig.gig_id;$(i.Gigs.gigsList).each(function(e,t){return t.gig_id==n?(i.currentGigIndex=e,!1):void 0})}},i.getAvailability=function(n,e){var n=n?n:i.gig.gig_id,e=e?e:i.currentUser,t=i.Gigs.gigs[n];return e&&t&&t.availability&&t.availability[e]?"-1"==t.approved?"Gig Declined":t.availability[e].available:""},i.editUserAttrib=function(i){$("#"+i).addClass("edit"),$("#"+i+"_input").focus()},i.editAvailable=function(n){i.setTab("availability"),i.memberavailablefilter=n},i.setAvailability=function(n,e){n=n||i.currentUser;var t={member_id:n};return e?t=i.Gigs.gigs[e].availability[n]:(e=i.gig.gig_id,t=i.gig.availability[n]),t.action="setAvailability",l.write("setAvailability",t,e).then(function(t){i.Gigs.gigs[e].availability[n]=t,e==i.gig.gig_id&&(i.gig.availability[n]=i.Gigs.gigs[e].availability[n]),i.Gigs.updateGigsList()})},i.currentUser||i.changeUser(),i.$watch("fetchAllGigs",function(n,e){n!=e&&i.fetchGigs()}),i.$watch("Members.members",function(){i.members=d.members,i.membersList=d.membersList,i.members&&(i.currentUserName=i.members[i.currentUser]?i.members[i.currentUser].name:"")});var m=i.$watch(function(){return i.members&&i.Gigs.gigsList&&i.Gigs.gigsList.length},function(n){n&&(a.action&&a.gig_id&&i.currentUser?(i.Gigs.gigs[a.gig_id].availability[i.currentUser].available=a.action,i.setAvailability(i.currentUser,a.gig_id).then(function(){i.setView()})):i.setView(),m())})}]);var app=angular.module("Giggity.directives",[]);app.directive("memberComments",[function(){return{restrict:"A",link:function(i,n,e){function t(e){if(e){var t=i.membersList,l="";$(t).each(function(n,t){if(e[t.id]&&e[t.id][a]){var s=t.name,o=i.gig.availability[t.id][a];l+="<strong>"+s+"</strong>:&nbsp;&nbsp;<span>"+o+"</span><br/>"}}),n.html(l)}}var a=e.type?e.type:"concerns";i.$watch("gig.availability[currentUser]",function(){t(i.gig.availability)},!0),t(i.gig.availability)}}}]),app.directive("fadeIn",function(){return{restrict:"A",link:function(i,n,e){i.$watch(e.fadeIn,function(i){i?$(n).fadeIn():$(n).hide()})}}}),app.directive("gigDetails",[function(){return{restrict:"A",link:function(i,n){function e(i){if(i){var e="";$(i.split("\n\n")).each(function(i,n){var t=n.split(":");t[0]=t[0].replace(/_/g," ").toLowerCase(),t[1]||(t[1]="&nbsp;"),e+='<dt style="text-transform:capitalize">'+t[0]+"</dt><dd class='clearfix'>"+t[1]+"</dd>"}),n.html(e)}}i.$watch("gig.details",function(i){e(i)}),e(i.gig.details)}}}]),app.directive("eatClick",function(){return function(i,n){$(n).click(function(i){return i.stopPropagation(),!1})}}),app.directive("feedbackButton",["$rootScope",function(i){return{restrict:"A",scope:{status:"@"},link:function(n,e,t){n.rootScope=i,e.bind("click",function(){n.$apply(function(){n.rootScope.remoteAction="pending",t.$set("disabled",!0),$(e).find(".glyphicon").hide(),e.prepend("<span class='processing-spinner glyphicon glyphicon-refresh glyphicon-spin'></span>")})}),n.$watch("rootScope.remoteAction",function(){n.rootScope.remoteAction||(t.$set("disabled",null),$(e).find(".processing-spinner").remove(),$(e).find(".glyphicon").show())})}}}]),app.directive("gigStatus",[function(){return{restrict:"A",link:function(i,n,e){function t(i){var e="glyphicon glyphicon-thumbs-up",t="text-success",a="Approved";-1==i?(e="glyphicon glyphicon-thumbs-down",t="text-error",a="Declined"):0==i&&(e="glyphicon glyphicon-question-sign",t="text-warning",a="Undecided"),n.html("<span class='"+t+"'><i class='"+e+"'></i> "+a+"</span>")}i.$watch("gig.approved",function(i){t(i)}),t(e.gigStatus)}}}]),app.directive("addclassonhover",function(){return{link:function(i,n,e){var t=e.addclassonhover;$(n).mouseenter(function(){$("."+t).removeClass(t),n.addClass(t)}),$(n).mouseleave(function(i){"SELECT"!=i.target.nodeName&&n.removeClass(t)})}}}),app.directive("editToggle",["$compile",function(i){return{scope:!0,link:function(n,e){n.editing=!1,n.showEdit=function(){n.editing=!0,e.addClass("edit"),$(e).find("textarea").focus()},e.find("span").after(i("<span ng-hide='editing' class='btn btn-default btn-xs' ng-click='showEdit()'><i class='glyphicon glyphicon-edit'></i> Edit<span>")(n)),e.find("textarea").on("blur",function(){n.$apply(function(){e.removeClass("edit"),n.editing=!1})})}}}]),app.directive("loadingFeedback",["$parse",function(i){return{restrict:"A",link:function(n,e,t){n.update=function(){e.parent().append("<span class='label label-primary feedback' type='button'><i class='glyphicon glyphicon-refresh glyphicon glyphicon-spin'></i> Saving...</button>");var a=i(t.loadingFeedback);a(n).then(function(){$(e).nextAll(".feedback").remove()})},e.on("change",n.update)}}}]),app.directive("resize",["$window",function(i){return{link:function(n){function e(){n.mobile=i.innerWidth<768}angular.element(i).bind("resize",function(){n.$broadcast("windowResize"),n.$apply(function(){e()})}),e()}}}]),app.directive("modal",["$rootScope","Gigs",function(i){return{restrict:"A",templateUrl:"modal.html",link:function(n){n.setUser=function(){n.user&&n.user.id?(n.currentUser=n.user.id,localStorage.currentUser=n.user.id,n.currentUserName=n.members[n.currentUser].name,$("#login_error").hide(),$("#login_form").removeClass("has-error"),n.showModal=!1,n.fetchGigs()):($("#login_form").addClass("has-error"),$("#login_error").show())},$("#modal").on("hidden.bs.modal",function(){n.$apply(function(){n.showModal=!1})}),n.$watch("showModal",function(n){0==n?($("#modal").modal("hide"),i.remoteAction=!1):($("#modal").modal("show"),$("#modal").on("shown.bs.modal",function(){$("#current_user_input").focus()}))})}}}]),app.directive("datePicker",function(){return{restrict:"E",template:'<div class="input-group date-picker"><input class="form-control" ng-model="model" use-native="true" data-model-date-format="yyyy-MM-dd" data-date-format="MM/dd/yyyy" data-date-type="string" data-autoclose="1" bs-datepicker type="text"><span ng-click="focus()" class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span></div>',scope:{model:"="},link:function(i,n){i.focus=function(){$(n).find("input").focus()}}}}),app.directive("timePicker",function(){return{restrict:"E",template:'<div class="input-group time-picker col-xs-5"><input class="form-control" size="8" ng-model="model" use-native="true" data-time-type="string" data-autoclose="1" bs-timepicker data-model-time-format="hh:mm a" data-time-format="h:mm a" data-length="1" data-minute-step="1" data-arrow-behavior="picker" type="text"><span ng-click="focus()" class="input-group-addon"><i class="glyphicon glyphicon-time"></i></span></div>',scope:{model:"="},link:function(i,n){i.focus=function(){$(n).find("input").focus()}}}});var app=angular.module("Giggity.filters",[]);app.filter("toArray",function(){return function(i){return i instanceof Object?$.map(i,function(i,n){return Object.defineProperty(i,"$key",{__proto__:null,value:n})}):i}}),app.filter("nlBr",function(){return function(i){return i?i.replace(/\n\n/g,"<br/>"):void 0}}),app.filter("length",function(){return function(i){return i.length}}),app.filter("memberProperty",function(){return function(i,n){var e=n[0],t=n[1]?n[1]:", ",a=[];return $(i).each(function(i,n){a.push(n[e])}),a.join(t)}}),app.filter("available",function(){return function(i){return i?i="Yes"==i?"Available":"No"==i?"Unavailable":i:void 0}}),app.filter("userUnknownCount",function(){return function(i,n){var e=0;return n&&$(i).each(function(i,t){-1!=t.approved&&"Unknown"==t.availability[n].available&&e++}),e}}),app.filter("URIencode",function(){return window.encodeURIComponent}),app.filter("availableFilter",function(){return function(i,n){var e=[],t=n[0];if(n[1]&&n[1].availability){var a=n[1].availability;return $(i).each(function(i,n){a[n.id]&&("Coming"!=t||"Yes"!=a[n.id].available&&"Maybe"!=a[n.id].available?(a[n.id].available==t||""==t)&&e.push(n):e.push(n))}),e}return i}}),app.filter("commentFilter",function(){return function(i,n){var e="comments",t=[];return n&&n.availability?($(i).each(function(i,a){n.availability[a.id]&&n.availability[a.id][e]&&t.push(a)}),t):i}}),app.filter("concernFilter",function(){return function(i,n){var e="concerns",t=[];return n&&n.availability?($(i).each(function(i,a){n.availability[a.id]&&n.availability[a.id][e]&&t.push(a)}),t):i}}),app.filter("member",function(){return function(i){return i?i.name:void 0}}),app.filter("time",function(){return function(i){if(!i)return null;if(i.indexOf("M")>=0)return i;var n=i.split(":"),e=n[0],t=n[1],a="AM";return e>12?(e-=12,a="PM"):12==e?a="PM":0==e&&(e=12),e+":"+t+" "+a}}),app.filter("slice",function(){return function(i,n,e){return i instanceof Array?i.slice(n).slice(0,e):i}});var app=angular.module("Giggity.services",[]);app.service("Members",["Requests","$filter",function(i,n){var e=this;return e.members=null,e.membersList=null,e.promise=i.fetch("fetchMembers").then(function(i){e.members=i,e.membersList=n("orderBy")(n("toArray")(e.members),"name")}),e.getMembers=function(){return members},e}]),app.service("Gigs",["Requests","$filter",function(i,n){var e=this;e.gigs=null,e.gigsList=null,e.updateGigsList=function(){e.gigsList=n("orderBy")(n("toArray")(e.gigs),"date")},e.fetchGigs=function(n,t){return i.fetch("fetchGigs",{fetchAllGigs:t,user_id:n}).then(function(i){e.gigs=i,e.updateGigsList()})};var t=localStorage.currentUser||null;return e.fetchGigs(t,!1),e}]),app.service("Requests",["$http","$rootScope",function(i,n){var e=this,t=function(i){n.remoteAction=!1;var i=i.data,e="An error occurred";if(1!==i.statusCode){var t;return"undefined"==typeof i.statusCode?(t="<pre>"+i+"</pre>",e="An unknown error occurred"):t=i.statusString,$("#status").html(e+": "+t).removeClass().addClass("alert alert-danger").show(),void(n.app_loaded=!0)}return $("#status").hide(),i.data};e.fetch=function(e,a){return n.remoteAction=e,a=a||{},a.action=e,i.get("backend/requests.php",{params:a,timeout:6e5}).then(t)},e.write=function(e,a,l){return n.remoteAction=e,i.post("backend/requests.php",{action:e,gig_id:l,data:a},{timeout:6e5}).then(t)}}]),angular.module("Giggity").run(["$templateCache",function(i){i.put("partials/partial2.html","<!--\n-->\n<div class='alert'style='display:none;' id='status'></div>\n<div id='content' class='{{mobileView}}' ng-class=\"{'mobile scroll-container':mobile}\">\n	<div class='well well-small scroll-container' ng-class='{\"col-sm-4\": !mobile}' id='nav' >\n		<nav class=\"navbar navbar-inverse scroll-header\">\n			<div class=\"container-fluid\">\n				<div class=\"navbar-header\">\n					<a href=\"#\" class=\"navbar-brand\"><img style='width:20px;display: inline' src='img/giggity.png'/> Giggity</a>\n				</div>\n				<!-- <p class='navbar-text navbar-right'>\n					<small class='navbar-text label' data-tooltip='{{ Gigs.gigsList | userUnknownCount:currentUser }} gigs with unknown availability' tooltip-placement='bottom' ng-class=\"(Gigs.gigsList | userUnknownCount:currentUser) == 0 && 'text-success' || 'label-danger'\">{{ Gigs.gigsList | userUnknownCount:currentUser }}</small>\n				</p> -->\n				<ul class=\"nav navbar-nav navbar-right\">\n					<li>\n						<a class='user-link' tooltip-placement='bottom' data-tooltip='Sign out or switch user' href='' ng-click='changeUser()'><i class='glyphicon glyphicon-user'></i> {{currentUserName && currentUserName || 'Not Signed In' }} </a>\n					</li>\n					<li>\n						<a><small class='badge' data-tooltip='{{ Gigs.gigsList | userUnknownCount:currentUser }} gigs with unknown availability' tooltip-placement='bottom' ng-class=\"(Gigs.gigsList | userUnknownCount:currentUser) == 0 && ' ' || 'badge-danger'\">{{ Gigs.gigsList | userUnknownCount:currentUser }}</small></a>\n					</li>\n					<li class=\"dropdown\" ng-hide='mobile'>\n						<a class=\"dropdown-toggle\" href='' data-toggle=\"dropdown\"><i class='glyphicon glyphicon-cog'></i></a>\n						<ul class='dropdown-menu'>\n							<li>\n								<div style='padding: 0px 10px;' class='checkbox'>\n									<label> <input type='checkbox' ng-model='fetchAllGigs'> Show Past Gigs</label>\n								</div>\n							</li>\n						</ul>\n					</li>\n				</ul>\n			</div><!-- /.container-fluid -->\n		</nav>\n		<table id='list_container' class='nav nav-list table table-striped table-condensed table-hover scroll-body'>\n			<tbody id='gig_list'>\n				<tr ng-show='Gigs.gigsList.length > gigLimit'>\n					<td colspan='3' class='text-center'>\n					</td>\n				</tr>\n				<tr style='display:none;'>\n					<td colspan='3'>\n						<button ng-click='newGig()' id='create_gig' class='btn btn-xs btn-info pull-right'><i class=\"glyphicon glyphicon-plus\"></i> Create New Gig</button>\n					</td>\n				</tr>\n				<tr>\n					<td colspan='3' class='text-center' ng-show='Gigs.gigsList.length > gigLimit'>\n						<pagination class=\"pagination-sm\" ng-model='page' items-per-page='gigLimit' max-size='7' boundary-links='true' total-items='Gigs.gigsList.length'></pagination>\n					</td>\n				</tr>\n				<tr ng-click='changeGig(current_gig.gig_id)' ng-repeat=\"current_gig in Gigs.gigsList | slice:gigLimit*(page-1):gigLimit\" ng-class=\"{active:current_gig.gig_id == gig.gig_id }\" id='{{current_gig.gig_id}}' addclassonhover='hover'>\n					<td>\n						<i class='approve_icon glyphicon' ng-class=\"{'glyphicon-thumbs-up': current_gig.approved==1, 'glyphicon-thumbs-down':current_gig.approved==-1, 'glyphicon-question-sign': current_gig.approved==0 && current_gig.type == 'gig', 'glyphicon-heart text-danger': current_gig.type == 'rehearsal'}\"></i>\n					</td>\n					<td>\n						<span ng-if='fetchAllGigs' class='date'>{{current_gig.date+'T08' | date:'MM/dd/yy'}}</span>\n						<span ng-if='!fetchAllGigs' class='date'>{{current_gig.date+'T08' | date:'MM/dd'}}</span>\n					</td>\n					<td style='width: 100%' class='form-inline'>\n						<span ng-show='mobile' class='pull-right mobile_nav_arrow'><i class='glyphicon glyphicon-chevron-right'></i></span>\n						<span ng-click='changeGig(current_gig.gig_id, 1);' eat-click=1 class='gig_list_edit pull-right'><i class='glyphicon glyphicon-pencil'></i> Edit</span>\n						<a href='' ng-class='{\"text-muted\": current_gig.approved == -1}'>{{current_gig.title}} </a>\n						<div class='form-inline' ng-show='currentUser && current_gig.approved != -1' ng-class=\"{'text-danger': getAvailability(current_gig.gig_id) == 'Unknown'}\">\n							<small>Your Availability:</small>\n							<select style='display: none;' loading-feedback='setAvailability({{currentUser}}, {{current_gig.gig_id}})' ng-model='Gigs.gigs[current_gig.gig_id].availability[currentUser].available' class='gig_list_availability_edit form-control input-xs' eat-click=1>\n								<option value='Yes' data-icon='glyphicon glyphicon-smile'>Available</option>\n								<option value='No' data-icon='glyphicon glyphicon-frown'>Unavailable</option>\n								<option data-icon='glyphicon glyphicon-meh'>Maybe</option>\n								<option data-icon='glyphicon glyphicon-question'>Unknown</option>\n							</select>\n							<small class='gig_list_availability'>\n								<i ng-class=\"{'glyphicon glyphicon-smile': Gigs.gigs[current_gig.gig_id].availability[currentUser].available == 'Yes', 'glyphicon glyphicon-frown': Gigs.gigs[current_gig.gig_id].availability[currentUser].available == 'No', 'glyphicon glyphicon-meh': Gigs.gigs[current_gig.gig_id].availability[currentUser].available == 'Maybe', 'glyphicon glyphicon-question': Gigs.gigs[current_gig.gig_id].availability[currentUser].available == 'Unknown'}\"></i>&nbsp;{{Gigs.gigs[current_gig.gig_id].availability[currentUser].available | available }}\n							</small>\n							<!-- <button data-loading-text='{{savingText}}' class='btn btn-default btn-xs availability-save-button' type='button'></button> -->\n						</div>\n					</td>\n				</tr>\n			</tbody>\n		</table>\n	</div>\n	<div class='mobile-nav navbar-inverse navbar-static-top container-fluid scroll-header'>\n		<div class='navbar-inner text-center row'>\n			<i class='glyphicon glyphicon-menu-hamburger' id='mobile_nav_link' ng-click=\"setView(true)\"></i>\n			<h3 class='navbar-text'>{{gig.title}}</h3>\n		</div>\n		<div class='row mobile-nav-controls'>\n			<div class='col-xs-12 text-center mobile-nav-date'>\n				<span class='navbar-text' ng-show='gig.date'>{{ gig.date+'T08' | date:'EEEE, MMMM d, y' }}</span>\n			</div>\n			<div class='col-xs-2 text-left'>\n				<a class='btn-prev btn-circle btn btn-primary' ng-show='Gigs.gigsList[currentGigIndex-1]' ng-click='changeGig(Gigs.gigsList[currentGigIndex-1].gig_id)'><i class='glyphicon glyphicon-menu-left'></i></a>\n			</div>\n			<div class='col-xs-8 text-center'>\n				<span class='btn-group'>\n					<button class='btn btn-primary btn-sm' feedback-button ng-click='saveGig()'><i class='glyphicon glyphicon-ok'></i> Save Gig</button>\n					<button class='btn btn-danger btn-sm' feedback-button ng-click='showModal=\"confirm\"'><i class='glyphicon glyphicon-remove'></i> Delete Gig</button>\n				</span>\n			</div>\n			<div class='col-xs-2 text-right'>\n				<a class='btn-next btn-circle btn btn-primary' ng-show='Gigs.gigsList[currentGigIndex+1]' ng-click='changeGig(Gigs.gigsList[currentGigIndex+1].gig_id)'><i class='glyphicon glyphicon-menu-right'></i></a>\n			</div>\n		</div>\n	</div>\n\n	<div style='' class='col-md-8 scroll-container' id='gig'>\n		<div id='gig_loading' ng-show='gig_loading' fade-in='gig_loading'>\n			<div>\n				<h1 class='text-center alert alert-info'><i class='glyphicon glyphicon-refresh glyphicon glyphicon-spin'></i> Loading</h1>\n			</div>\n		</div>\n		<div ng-if='gig.gig_id' class='scroll-container'>\n			<div class='page-header scroll-header'>\n				<h1>\n					<div class='pull-right text-right'>\n						<div class='btn-group'>\n							<button class='btn btn-primary' feedback-button ng-click='saveGig()'><i class='glyphicon glyphicon-ok'></i> Save Gig</button>\n							<button class='btn btn-danger' feedback-button ng-click='$parent.showModal=\"confirm\"'><i class='glyphicon glyphicon-remove'></i> Delete Gig</button>\n						</div>\n					</div>\n					{{gig.title}}<br/>\n					<small ng-show='gig.date'>{{ gig.date+'T08' | date:'EEEE, MMMM d, y' }}&nbsp; <span ng-if='gig.type == \"gig\"' gig-status='{{gig.approved}}'></span></small>\n				</h1>\n						<div class='col-xs-2'>\n							<a class='btn btn-xs btn-default' ng-show='Gigs.gigsList[currentGigIndex-1]' ng-click=\"changeGig(Gigs.gigsList[currentGigIndex-1].gig_id)\"><i class='glyphicon glyphicon-menu-left'></i> Previous Gig</a>\n						</div>\n						<div class='col-xs-8 text-center' id='availableCounts'>\n							<h4>\n								<span ng-click=\"editAvailable('Yes')\" class='label label-success'>{{(membersList | availableFilter:['Yes', gig]).length }} Available</span>\n								<span ng-click=\"editAvailable('Maybe')\" class='label label-warning'>{{(membersList | availableFilter:['Maybe', gig]).length }} Maybes</span>\n								<span ng-click=\"editAvailable('No')\" class='label label-danger'>{{(membersList | availableFilter:['No', gig]).length }} Unavailable</span>\n							</h4>\n						</div>\n						<div class='col-xs-2 text-right'>\n							<a class='btn btn-xs btn-default' ng-show='Gigs.gigsList[currentGigIndex+1]' ng-click=\"changeGig(Gigs.gigsList[currentGigIndex+1].gig_id)\">Next Gig <i class='glyphicon glyphicon-menu-right'></i></a>\n						</div>\n			</div>\n\n			<form ng-show='gig.type == \"rehearsal\"' id='edit_gig' class='form-horizontal clearfix rehearsal-form scroll-body' ng-submit=\"saveGig()\">\n				<input style='visibility: hidden; position: absolute; top:0px; left: 0px; width: 1px; height: 1px;' type='submit'/>\n				<input type='hidden' name='gig_id' ng-model='gig.gig_id'/>\n				<div class='rehearsal-container'>\n					<div class='form-horizontal container-fluid'>\n						<div ng-show='currentUser' class='form-group'>\n							<label class='col-md-4 control-label text-right'>Your Availability</label>\n							<div class='col-md-8' ng-class=\"getAvailability() == 'Unknown' && 'bg-danger' || ''\">\n								<div class='alert-danger' ng-show=\"getAvailability() == 'Unknown'\">You haven't entered your availability for this rehearsal.</div>\n									<div class='user_gig_details_edit form-inline' ng-init='saving=false' feedback='saving'>\n										<select id='user_availability_input' ng-model='gig.availability[currentUser].available' class='form-control' loading-feedback='setAvailability()'>\n											<option value='Yes' data-icon='glyphicon glyphicon-smile'>Available</option>\n											<option value='No' data-icon='glyphicon glyphicon-frown'>Unavailable</option>\n											<option data-icon='glyphicon glyphicon-meh'>Maybe</option>\n											<option data-icon='glyphicon glyphicon-question'>Unknown</option>\n										</select>\n									</div>\n							</div>\n						</div>\n						<div class='form-group'>\n							<label class='col-md-4 control-label text-right' for='title'>Title</label>\n							<div class='col-md-8'>\n								<input class='form-control' type='text' ng-model='gig.title'/>\n							</div>\n						</div>\n						<div class='form-group'>\n							<label class='col-md-4 control-label text-right' for='date'>Date</label>\n							<div class='col-md-8'>\n								<date-picker model='gig.date'></date-picker>\n							</div>\n						</div>\n						<div class='form-group'>\n							<label class=\"col-md-4 control-label text-right\">Time</label>\n							<div class='col-md-8'>\n								<time-picker model='gig.band_start'></time-picker>\n								<label for='band_end'  style='vertical-align: text-bottom;'>To</label>\n								<time-picker model=\"gig.band_end\"></time-picker>\n							</div>\n						</div>\n						<div class='form-group'>\n							<label class='col-md-4 control-label text-right' for='location'>Location</label>\n							<div class='col-md-8'>\n								<input class='form-control' type='text' ng-model='gig.location'/>\n							</div>\n						</div>\n						<div class='form-group'>\n							<label class='col-md-4 control-label text-right' for='tactical'>Facilitator</label>\n							<div class='col-md-8'>\n								<input class='form-control' autocomplete='off' type='text' ng-model='gig.tactical' typeahead='member as member.name for member in membersList | filter:{name:$viewValue}' />\n							</div>\n						</div>\n						<div class='form-group'>\n							<label class='col-md-4 control-label text-right' for='notes'>Notes</label>\n							<div class='col-md-8'>\n								<textarea class='form-control' spellcheck=\"true\" rows=5 ng-model='gig.notes'></textarea>\n							</div>\n						</div>\n						<div class='form-group'>\n							<label class='col-md-4 control-label text-right'>Who's Coming</label>\n							<div class='col-md-8'>\n								<strong>Yeses:</strong> {{(membersList | availableFilter:['Yes', gig] | memberProperty:['name'])}}\n								<br/><strong>Maybes:</strong> {{(membersList |  availableFilter:['Maybe', gig] |  memberProperty:['name'])}}\n								<br/><strong>Noes:</strong> {{(membersList |  availableFilter:['No', gig] |  memberProperty:['name'])}}\n								<br/>Contact Yeses and Maybes: <a href=\"sms:{{(membersList | availableFilter:['Coming', gig] | memberProperty:['phone'])}}\">Text</a> |\n								<a href=\"mailto:{{(membersList | availableFilter:['Coming', gig] | memberProperty:['email', ';'])}}\">Email</a>\n							</div>\n						</div>\n					</div>\n				</div>\n			</form>\n\n			<form ng-show='gig.type == \"gig\"' id='edit_gig' class='form-horizontal clearfix gig-form scroll-container' ng-submit=\"saveGig()\">\n				<input style='visibility: hidden; position: absolute; top:0px; left: 0px; width: 1px; height: 1px;' type='submit'/>\n				<input type='hidden' name='gig_id' ng-model='gig.gig_id'/>\n				<tabset justified=\"!mobile\">\n					<tab heading='Details' class='form-inline' id='gig_details' active=\"tab['gig_details']\">\n						<dl id='gig_details_list' class='dl-horizontal' style='clear:both'>\n							<dt>Approval Status</dt>\n							<dd class='clearfix' gig-status='{{gig.approved}}'></dd>\n\n							<div ng-show='currentUser' id='availability_info' ng-class=\"getAvailability() == 'Unknown' && 'alert-danger' || 'alert-info'\" class='alert alert-info'>\n								<div class='lead' ng-show=\"getAvailability() == 'Unknown'\">You haven't entered your availability for this gig.</div>\n								<dt>Your Availability</dt>\n								<dd id='user_availability' class='user_gig_details'>\n									<div class='user_gig_details_none'>\n										<i ng-class=\"{'glyphicon glyphicon-smile': gig.availability[currentUser].available == 'Yes', 'glyphicon glyphicon-frown': gig.availability[currentUser].available == 'No', 'glyphicon glyphicon-meh': gig.availability[currentUser].available == 'Maybe', 'glyphicon glyphicon-question': gig.availability[currentUser].available == 'Unknown'}\"></i> {{gig.availability[currentUser].available | available }}\n										<span class='btn btn-xs btn-default' ng-click='editUserAttrib(\"user_availability\")'><i class='glyphicon glyphicon-edit'></i> Edit</span>\n									</div>\n									<div class='user_gig_details_edit form-inline'>\n										<select id='user_availability_input' ng-model='gig.availability[currentUser].available' class='form-control input-sm' loading-feedback='setAvailability()'>\n											<option value='Yes' data-icon='glyphicon glyphicon-smile'>Available</option>\n											<option value='No' data-icon='glyphicon glyphicon-frown'>Unavailable</option>\n											<option data-icon='glyphicon glyphicon-meh'>Maybe</option>\n											<option data-icon='glyphicon glyphicon-question'>Unknown</option>\n										</select>\n									</div>\n								</dd>\n								<dt ng-hide='gig.approved!=0'>Your Concerns</dt>\n								<dd ng-hide='gig.approved!=0' id='user_concerns' class='user_gig_details' edit-toggle>\n									<textarea class='form-control user_gig_details_edit' id='user_concerns_input' spellcheck=\"true\" rows=5 ng-model='gig.availability[currentUser].concerns' placeholder=\"Do you have concerns about the BLO supporting this gig?\" loading-feedback='setAvailability()'></textarea>\n									<apan class='user_gig_details_none'>{{gig.availability[currentUser].concerns || 'None' }}</span>\n								</dd>\n								<dt>Your Comments</dt>\n								<dd id='user_comments' class='user_gig_details' edit-toggle>\n									<textarea class='form-control user_gig_details_edit' id='user_comments_input' spellcheck=\"true\" rows=5 ng-model='gig.availability[currentUser].comments' placeholder=\"Enter any questions or comments you have about the gig\"  loading-feedback='setAvailability()'></textarea>\n									<span class='user_gig_details_none'>{{gig.availability[currentUser].comments || 'None' }}</span>\n								</dd>\n						</div>\n							<dt>When</dt>\n							<dd class='clearfix'><span ng-show='gig.date'>{{ gig.date+'T08' | date:'EEEE, MMMM d, y' }} from {{gig.start_time | time }} - {{ gig.end_time  | time}}\n								<br/>Meet at {{ gig.meet_time | time }}\n								<br/>Band play time from {{gig.band_start | time }} to {{gig.band_end | time}}\n								</span>&nbsp;\n							</dd>\n							<dt>Where</dt>\n							<dd class='clearfix'>{{ gig.location}} <span ng-show='gig.location'>[<small><a href='http://maps.google.com?q={{gig.location | URIencode }}' target='map'><i class='glyphicon glyphicon-map-marker'></i>Map</a></small>]</span>&nbsp; </dd>\n							<dt>Tactical</dt>\n							<dd class='clearfix'>\n								{{gig.tactical.name}} &nbsp;\n								<span ng-show='gig.tactical'>\n									<a class='btn btn-info btn-xs' href='mailto:{{gig.tactical.email}}'>Email</a>\n									<a class='btn btn-info btn-xs' href='smsto:{{gig.tactical.phone}}'>Text</a>\n									<a class='btn btn-info btn-xs' href='tel:{{gig.tactical.phone}}'>Call</a>\n								</span>\n							</dd>\n							<dt>Musical</dt>\n							<dd class='clearfix'>\n								{{ gig.musical.name }} &nbsp;\n								<span ng-show='gig.musical'>\n									<a class='btn btn-info btn-xs' href='mailto:{{gig.musical.email}}'>Email</a>\n									<a class='btn btn-info btn-xs' href='sms:{{gig.musical.phone}}'>Text</a>\n									<a class='btn btn-info btn-xs' href='tel:{{gig.musical.phone}}'>Call</a>\n								</span>\n							</dd>\n							<dt>Colors</dt>\n							<dd class='clearfix'>{{ gig.colors}}&nbsp; </dd>\n							<dt>Who's Coming</dt>\n								<dd class='clearfix'>\n									<strong>Yeses:</strong> {{(membersList | availableFilter:['Yes', gig] | memberProperty:['name'])}}\n									<br/><strong>Maybes:</strong> {{(membersList |  availableFilter:['Maybe', gig] |  memberProperty:['name'])}}\n									<br/><strong>Noes:</strong> {{(membersList |  availableFilter:['No', gig] |  memberProperty:['name'])}}\n									<br/>Contact Yeses and Maybes:\n									<span ng-show='gig.tactical'>\n										<a class='btn btn-info btn-xs' href=\"mailto:{{(membersList | availableFilter:['Coming', gig] | memberProperty:['email', ';'])}}\">Email</a>\n										<a class='btn btn-info btn-xs' href=\"sms:{{(membersList | availableFilter:['Coming', gig] | memberProperty:['phone'])}}\">Text</a>\n									</span>\n								</dd>\n\n							<dt>Notes</dt>\n							<dd class='clearfix'>{{ gig.notes}}&nbsp; </dd>\n							<div ng-class=\"{'alert alert-danger':(membersList | concernFilter:gig).length > 0}\">\n								<dt>Member Concerns</dt>\n								<dd class='clearfix'>\n									<span class='' member-comments></span>\n								</dd>\n							</div>\n							<dt>Member Comments</dt>\n								<dd class='clearfix'>\n									<span class='' member-comments type='comments'></span>\n								</dd>\n							<!--<div ng-show='isCollapsed'><dt><a href='' ng-click=\"isCollapsed = !isCollapsed\">More details…</a></dt><dd>&nbsp;</dd></div>\n							<div collapse='isCollapsed'>-->\n							<h4 class='text-info'>Event Details</h4>\n								<dt>Description</dt>\n								<dd class='clearfix' ng-bind-html=\"gig.description | linky\"></dd>\n								<dt>Public Description</dt>\n								<dd class='clearfix' ng-bind-html=\"gig.public_description | linky\"></dd>\n								<dt>Organizer</dt>\n								<dd class='clearfix'>{{ gig.who}}&nbsp; </dd>\n								<dt>Contact</dt>\n								<dd class='clearfix' ng-bind-html=\"gig.contact | linky\"></dd>\n								<dt>URL</dt>\n								<dd class='clearfix' ng-bind-html=\"gig.url | linky\"></dd>\n								<div gig-details='1'></div>\n								<!--</div>-->\n\n						</dl>\n					</tab>\n					<tab heading='Band Info' class='tab-pane' id='band_details' active=\"tab['band_details']\">\n						<div class='alert alert-danger' ng-show=\"gig.approved == 1 && !gig.public_description\">This gig has been approved, but can't be published to the public calendar until a public description has been entered below.</div>\n						<div class='form-horizontal container-fluid'>\n							<div class='form-group'>\n								<label class='col-md-4 control-label text-right' for='title'>Title</label>\n								<div class='col-md-8'>\n									<input class='form-control' type='text' ng-model='gig.title'/>\n								</div>\n							</div>\n							<div class='form-group'>\n								<label class=\"col-md-4 control-label text-right\">Band Approval</label>\n								<div class=\"col-md-8\">\n									<div class=\"btn-group\">\n										<button type=\"button\" class=\"btn btn-default\" ng-click='gig.approved=1' ng-class=\"{'active btn-success': gig.approved == 1}\"><i class='glyphicon glyphicon-thumbs-up'></i> Approved</button>\n										<button type=\"button\" class=\"btn btn-default\" ng-click='gig.approved=0' ng-class=\"{'active btn-warning': gig.approved == 0}\" ><i class='glyphicon glyphicon-question-sign'></i> Undecided</button>\n										<button type=\"button\" class=\"btn btn-default\" ng-click='gig.approved=-1' ng-class=\"{'active btn-danger': gig.approved == -1}\" ><i class='glyphicon glyphicon-thumbs-down'></i> Declined</button>\n									</div>\n								</div>\n							</div>\n							<div class='form-group'>\n								<label class=\"col-md-4 control-label text-right\">Band Meet Time</label>\n								<div class='col-md-8'>\n										<time-picker model='gig.meet_time'></time-picker>\n								</div>\n							</div>\n							<div class='form-group'>\n								<label class=\"col-md-4 control-label text-right\">Band Play Time</label>\n								<div class='col-md-8'>\n									<time-picker model=\"gig.band_start\"></time-picker>\n									<label for='band_end'  style='vertical-align: text-bottom;'>To</label>\n									<time-picker model=\"gig.band_end\"></time-picker>\n								</div>\n							</div>\n							<div class='form-group'>\n								<label class='col-md-4 control-label text-right' for='tactical'>Tactical</label>\n								<div class='col-md-8'>\n									<input class='form-control' autocomplete='off' type='text' ng-model='gig.tactical' typeahead='member as member.name for member in membersList | filter:{name:$viewValue}' />\n								</div>\n							</div>\n							<div class='form-group'>\n								<label class='col-md-4 control-label text-right' for='musical'>Musical</label>\n								<div class='col-md-8'>\n									<input class='form-control' autocomplete='off' type='text' typeahead='member as member.name for member in membersList | filter:{name: $viewValue}' ng-model='gig.musical'/>\n								</div>\n							</div>\n							<div class='form-group'>\n								<label class='col-md-4 control-label text-right' for='colors'>Colors</label>\n								<div class='col-md-8'>\n									<input class='form-control' type='text' autocomplete='off' typeahead=\"c for c in ['Red and Black', 'Pink and Black', 'Black and Black'] | filter:$viewValue\" ng-model='gig.colors'/>\n								</div>\n							</div>\n							<div class='form-group'>\n								<label class='col-md-4 control-label text-right' for='public_description'>Public Description</label>\n								<div class='col-md-8'>\n									<textarea placeholder='Enter a short (2-3 lines) description for the public calendar and website' class='form-control' spellcheck=\"true\" ng-model='gig.public_description'></textarea>\n								</div>\n							</div>\n							<div class='form-group'>\n								<label class='col-md-4 control-label text-right' for='notes'>Notes</label>\n								<div class='col-md-8'>\n									<textarea class='form-control' spellcheck=\"true\" rows=5 ng-model='gig.notes'></textarea>\n								</div>\n							</div>\n						</div>\n					</tab>\n					<tab heading='Event Info' class='tab-pane' id='event_details' active=\"tab['event_details']\">\n						<div class='form-horizontal container-fluid'>\n							<div class='form-group'>\n								<label class='col-md-4 control-label text-right' for='title'>Title</label>\n								<div class='col-md-8'>\n									<input class='form-control' type='text' ng-model='gig.title'/>\n								</div>\n							</div>\n							<div class='form-group'>\n								<label class='col-md-4 control-label text-right' for='date'>Date</label>\n								<div class='col-md-8'>\n									<date-picker model=\"gig.date\"></date-picker>\n								</div>\n							</div>\n							<div class='form-group'>\n								<label class=\"col-md-4 control-label text-right\">Event Time</label>\n								<div class='col-md-8'>\n									<time-picker model=\"gig.start_time\"></time-picker>\n									<label for='band_end'  style='vertical-align: text-bottom;'>To</label>\n									<time-picker model=\"gig.end_time\"></time-picker>\n								</div>\n							</div>\n							<div class='form-group'>\n								<label class='col-md-4 control-label text-right' for='location'>Location</label>\n								<div class='col-md-8'><input class='form-control' type='text' ng-model='gig.location'/></div>\n							</div>\n							<div class='form-group'>\n								<label class='col-md-4 control-label text-right' for='description'>Description</label>\n								<div class='col-md-8'><textarea class='form-control' spellcheck=\"true\" rows=5 ng-model='gig.description'></textarea></div>\n							</div>\n							<div class='form-group'>\n								<label class='col-md-4 control-label text-right' for='url'>URL</label>\n								<div class='col-md-8'><input class='form-control' type='text' ng-model='gig.url'/></div>\n							</div>\n							<div class='form-group'>\n								<label class='col-md-4 control-label text-right' for='who'>Organizer</label>\n								<div class='col-md-8'><input class='form-control' type='text' ng-model='gig.who'/></div>\n							</div>\n							<div class='form-group'>\n								<label class='col-md-4 control-label text-right' for='contact'>Contact</label>\n								<div class='col-md-8'><input class='form-control' type='text' ng-model='gig.contact'/></div>\n							</div>\n							<div class='form-group'>\n								<label class='col-md-4 control-label text-right' for='details'>Details</label>\n								<div class='col-md-8'><textarea class='form-control' spellcheck=\"true\" rows=8 ng-model='gig.details'></textarea></div>\n							</div>\n						</div>\n					</tab>\n					<tab heading='Availability' class='tab-pane' id='availability' active=\"tab['availability']\">\n						<div class='band-availability'>\n							<div class='panel panel-default'>\n								<div class='panel-heading'>\n									<div class='row form-inline text-center'>\n										<span class='col-xs-6'>\n											<label for='name_filter'>Name:</label>\n											<input name='name_filter' autocomplete='off' style='margin-right: 20px;' class='form-control input-sm' type='text' ng-model='membernamefilter'/>\n										</span>\n										<span class='col-xs-6'>\n											<label for='availability_filter'>Availability:</label>\n											<select name='availability_filter' class='form-control input-sm' ng-model='memberavailablefilter' id='member_availability_filter'>\n												<option value='' data-icon='glyphicon glyphicon-smile'>All</option>\n												<option value='Yes' data-icon='glyphicon glyphicon-smile'>Available</option>\n												<option value='No' data-icon='glyphicon glyphicon-frown'>Unavailable</option>\n												<option data-icon='glyphicon glyphicon-meh'>Maybe</option>\n												<option data-icon='glyphicon glyphicon-question'>Unknown</option>\n											</select>\n										</span>\n									</div>\n								</div>\n								<ul class='list-group'>\n									<li ng-class=\"{\n											'list-group-item-success': gig.availability[member.id].available == 'Yes',\n											'list-group-item-warning': gig.availability[member.id].available == 'Maybe',\n											'list-group-item-danger': gig.availability[member.id].available == 'No'\n										}\" class='list-group-item' ng-repeat=\"member in membersList | filter:{name:membernamefilter} | availableFilter:[memberavailablefilter, gig]\" id=\"availability_{{member.id}}\">\n										<div class='row'>\n											<span class='col-xs-5'>\n												{{member.name}} <small ng-style=\"{display: mobile ? 'block': ''}\">({{member.groups}})</small>\n											</span>\n											<span class='col-xs-7'>\n												<div class=\"btn-group btn-group\" ng-class='{\"btn-group-xs\": mobile}' ng-click='update()' loading-feedback=\"setAvailability({{member.id}})\">\n														<label class=\"btn btn-default\" ng-class=\"{'btn-success': gig.availability[member.id].available == 'Yes'}\" ng-model=\"gig.availability[member.id].available\" btn-radio=\"'Yes'\">Yes</label>\n														<label class=\"btn btn-default\" ng-class=\"{'btn-warning': gig.availability[member.id].available == 'Maybe'}\" ng-model=\"gig.availability[member.id].available\" btn-radio=\"'Maybe'\">Maybe</label>\n														<label class=\"btn btn-default\" ng-class=\"{'btn-danger': gig.availability[member.id].available == 'No'}\" ng-model=\"gig.availability[member.id].available\" btn-radio=\"'No'\">No</label>\n														<label class=\"btn btn-default\" ng-model=\"gig.availability[member.id].available\" btn-radio=\"'Unknown'\">Unknown</label>\n												</div>\n											</span>\n										</div>\n									</li>\n								</ul>\n							</div>\n						</div>\n					</tab>\n				</tabset>\n			</form>\n		</div>\n	</div>\n</div>\n<div modal='{{showModal}}'></div>\n\n<script type=\"text/ng-template\" id=\"modal.html\">\n	<div id='modal' class='modal fade' data-keyboard='true' data-backdrop='true'>\n		<div class=\"modal-dialog\">\n			<div class=\"modal-content\">\n				<div ng-show='showModal == \"login\"'>\n					<div class=\"modal-header\">\n				    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\">&times;</button>\n				    <h3>Sign In!</h3>\n				  </div>\n				  <div class=\"modal-body\" style='max-height: 10000px; overflow: visible;'>\n					  <p>This will make it easier for you to set your gig availability</p>\n					  <form id='login_form' class='form-inline' ng-submit='setUser()'>\n							<span id='login_error' class=\"help-inline text-danger\" style='display: none;'>The name you typed isn't recognized. Please select a name from the dropdown. </span>\n						  <input class='form-control' autocomplete='off' id='current_user_input' type='text' ng-model='user' placeholder='Just type your name' typeahead='member as member.name for member in membersList | filter:{name:$viewValue}' />\n					    <button type='submit' class=\"btn btn-primary\">OK</button>\n					    <button type='button' ng-click='showModal=false' class=\"btn btn-default\">Sign Out</button>\n						</form>\n					</div>\n				</div>\n				<div ng-show='showModal == \"confirm\"'>\n					<div class=\"modal-header\">\n						<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\">&times;</button>\n						<h3>Delete '{{gig.title}}'?</h3>\n					</div>\n					<div class=\"modal-body\">\n						<p>Are you sure?</p>\n					</div>\n					<div class=\"modal-footer\">\n						<a href=\"\" ng-click='deleteGig(gig.gig_id)' class=\"btn btn-primary\">Yes</a>\n						<a href=\"\" ng-click='showModal=false' class=\"btn btn-default\">Cancel</a>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n</script>\n")
}]);